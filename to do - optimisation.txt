while вместо for

поискать как шаблонами заменить виртульность и наследование